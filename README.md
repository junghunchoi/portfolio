#  junghun's portfolio

## ğŸ¤” í”„ë¡œì íŠ¸ ì†Œê°œ

ë²¡ì—”ë“œ ê°œë°œìì—ê²Œ ìë°”, íŒŒì´ì¬, ë…¸ë“œJSë§Œ ì•Œë©´ ì¶©ë¶„í• ê¹Œìš”? ì´ëŸ° ê³ ë¯¼ì„ í•´ë´¤ìŠµë‹ˆë‹¤. </br>
í•˜ì§€ë§Œ ê¹Šì´ ìƒê°í•´ë³´ë©´, ì•„ë¬´ë¦¬ í›Œë¥­í•œ ë°ì´í„°ë¥¼ ê°€ê³µí–ˆì–´ë„ ì´ë¥¼ ì‚¬ìš©ìì—ê²Œ íš¨ê³¼ì ìœ¼ë¡œ ì „ë‹¬í•˜ê³  í‘œí˜„í•˜ì§€ ëª»í•œë‹¤ë©´ ë¬´ìš©ì§€ë¬¼ì´ ë  ê²ƒì…ë‹ˆë‹¤. </br>
ë§ˆì¹˜ íŒ¥ ì—†ëŠ” ë¶•ì–´ë¹µì´ë‚˜ ì•™ê¼¬ ì—†ëŠ” ì°ë¹µì²˜ëŸ¼ ë§ì´ì£ . </br>
ê·¸ë˜ì„œ ì €ëŠ” í•œêµ­ì—ì„œ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” <b>Spring</b>ê³¼ <b>Vue</b>ë¥¼ í™œìš©í•˜ì—¬ <b>RESTful</b> ì•„í‚¤í…ì²˜ ê¸°ë°˜ìœ¼ë¡œ ê°œë°œí•˜ëŠ” ê²ƒì´ ì¢‹ê² ë‹¤ê³  ê²°ì‹¬í–ˆìŠµë‹ˆë‹¤. </br>

## ì•„ë˜ì˜ ë§í¬ì™€ ê³„ì •ìœ¼ë¡œ í™•ì¸í•´ì£¼ì„¸ìš” :)

âš ï¸ <b>ì£¼ì˜: ë¹„ìš© ì ˆê°ì„ ìœ„í•´ t2.micro ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì˜€ìœ¼ë¯€ë¡œ, ì†ë„ê°€ ë‹¤ì†Œ ëŠë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </b>
## <a href="http://13.210.146.57:1542" target="_blank"> í¬íŠ¸í´ë¦¬ì˜¤ ë§í¬ <= </a>

ì‚¬ìš©ì ì•„ì´ë”” : user

ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ : a1234 

ì‚¬ìš©ì ì•„ì´ë”” : admin

ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ : a1234


</br>

## <a href="https://documenter.getpostman.com/view/22369547/2sA3BoZWgk" target="_blank"> ğŸ“– Api ë¬¸ì„œ</a>
- í¬íŠ¸í´ë¦¬ì˜¤ì˜ postman ê¸°ë°˜ api ë¬¸ì„œ

</br>


## â­ ì£¼ìš” ê¸°ëŠ¥
- ì‚¬ìš©ì ë° ê´€ë¦¬ìì˜ ê¸°ëŠ¥ ë¶„ê¸°
- ë°±ì—”ë“œ, í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ë° ìš´ì˜ í™˜ê²½ ë¶„ë¦¬
- í”„ë¡ íŠ¸ì˜ ìƒíƒœ ê´€ë¦¬
- JPAë¥¼ í†µí•´ ì˜ì†ì„± ê´€ë¦¬
- ì²¨ë¶€íŒŒì¼, ëŒ“ê¸€, ì •ë ¬ ë“± ê²Œì‹œíŒì´ ê¸°ë³¸ìœ¼ë¡œ í•„ìš”ë¡œ í•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ êµ¬í˜„


## ğŸ“ºí™”ë©´ë¦¬ìŠ¤íŠ¸
í™”ë©´ì„¤ëª…ì€ ë™ì˜ìƒìœ¼ë¡œ


</br>

## ğŸ“Œì½”ë“œ ê°„ëµì„¤ëª…


<details>
<summary><b>ìŠ¤í”„ë§ ì‹œíë¦¬í‹°</b></summary>
<div markdown="1">

```java
/**
 * 1. ë¡œê·¸ì¸ì€ CustomSecurityConfigì˜ APILoginFilterë¡œë¶€í„° ì‹œì‘ë˜ë©° "/login"ìœ¼ë¡œ ì‹œì‘ë©ë‹ˆë‹¤.
 * 2. tokenCheckFilterë¥¼ í†µí•´ ìš”ì²­ì˜ headerì˜ accessTokenì„ í™•ì¸í•©ë‹ˆë‹¤.
 * 3. 1) accessTokenì˜ ìœ íš¨ê¸°ê°„ì´ ë§Œë£Œëœ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ì—ì„  /api/refreshToken ìš”ì²­í•©ë‹ˆë‹¤
      2) refreshTokenì´ ìœ íš¨í•  ê²½ìš° accessTokenì„ ì¬ë°œê¸‰í•˜ë©° ê¸°íƒ€ ì •ì±…ì— ì˜í•´ refreshTokenë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. 
 */
class CustomSecurityConfig{
    ...
	APILoginFilter apiLoginFilter = new APILoginFilter("/login");
		apiLoginFilter.setAuthenticationManager(authenticationManager);
		http.addFilterBefore(apiLoginFilter, UsernamePasswordAuthenticationFilter.class);
		
	ApiLoginSuccessHandler apiLoginSuccessHandler = new ApiLoginSuccessHandler(jwtUtil);
		apiLoginFilter.setAuthenticationSuccessHandler(apiLoginSuccessHandler);
		
    http.addFilterBefore(tokenCheckFilter(jwtUtil, userDetailsService),
	UsernamePasswordAuthenticationFilter.class);
	
    http.addFilterBefore(new RefreshTokenFilter("/api/refreshToken", jwtUtil),
	TokenCheckFilter.class);
...
}

```

```java

/**
    Serviceì—ì„œ ê¶Œí•œì„ ì²´í¬í•  ê²½ìš° contextHolderì— ì €ì¥ëœ ì‚¬ìš©ìì˜ ê¶Œí•œì„ ì²´í¬í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œ
 */
public String getUserAuthority() {
		Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
		if (authentication != null && authentication.getPrincipal() instanceof UserDetails) {
			UserDetails userDetails = (UserDetails) authentication.getPrincipal();
			Collection<? extends GrantedAuthority> authorities = userDetails.getAuthorities();

			for (GrantedAuthority authority : authorities) {
				if (authority.getAuthority().equals("ROLE_ADMIN")) {
					return "ROLE_ADMIN";
				}
			}
		}
		return "ROLE_USER";
	}
```
</div>
</details>
<details>
<summary><b>JPA</b></summary>
<div markdown="1">

<a src="https://github.com/junghunchoi/portfolio/blob/master/backend/src/main/java/com/backend/repository/board/search/BoardSearchImpl.java">BoardSearchImpl</a>

``` java

/**
Querydslë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•œ ì˜ì—­ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì— ë”°ë¼
where, order by ë“±ì„ ë¶„ê¸°í•˜ì—¬ ì¡°íšŒí•˜ê³  
Pageableì„ ë°˜í™˜í•˜ì—¬ í˜ì´ì§•ì²˜ë¦¬ë¥¼ í•˜ì˜€ìŠµë‹ˆë‹¤.
*/
class BoardSearchImpl{
    ...
	public Page<BoardListDTO> searchBoardListWithReplyandFiles(String[] types, String keyword,
		String sort, String order, Pageable pageable) {
		
		...
		
		QBoard board = QBoard.board;
		QReply reply = QReply.reply;
		QFile file = QFile.file;
		QCategory category = QCategory.category;

		JPQLQuery<Board> query = from(board);
		query.leftJoin(board.category, category);
		query.leftJoin(reply).on(reply.board.eq(board));
		query.leftJoin(file).on(file.board.eq(board));

		query.groupBy(board);

		if ((types != null && types.length > 0) && keyword != null) {
			BooleanBuilder booleanBuilder = new BooleanBuilder();

			for (String type : types) {
				switch (type) {
					case "t" -> booleanBuilder.or(board.title.contains(keyword));
					case "c" -> booleanBuilder.or(board.content.contains(keyword));
					case "w" -> booleanBuilder.or(board.writer.contains(keyword));
				}
			}
			query.where(booleanBuilder);
		}
		//ììœ ê²Œì‹œíŒë§Œ ì¡°íšŒ
		query.where(board.boardType.eq(1));
		
		...
		return new PageImpl<>(...);
		
	}
        
        
        ...
}
```
</div>
</details>
<details>
<summary><b>ì—ëŸ¬ì²˜ë¦¬</b></summary>
<div markdown="1">

<a src="https://github.com/junghunchoi/portfolio/blob/master/backend/src/main/java/com/backend/exception/CustomRestAdvice.java">CustomRestAdvice</a>

```java

/**
 dto ìœ íš¨ì„±ê²€ì¦ì—ì„œ ì˜ëª»ë  ê²½ìš° í´ë¼ì´ì–¸íŠ¸ì—” í•„ë“œì™€ messageë¥¼ ì‘ë‹µí•˜ê²Œë˜ê³ 
 ì„œë²„ì—ì„  ë””í…Œì¼í•œ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆê²Œ í•˜ì˜€ìŠµë‹ˆë‹¤.
 */

@RestControllerAdvice
public class CustomRestAdvice {

	@ExceptionHandler(MethodArgumentNotValidException.class)
	protected ResponseEntity<ErrorResponse> handleMethodArgumentNotValidException(
		MethodArgumentNotValidException e) {
		BindingResult bindingResult = e.getBindingResult();
		StringBuilder stringBuilder = new StringBuilder();
		for (FieldError fieldError : bindingResult.getFieldErrors()) {
			stringBuilder.append(fieldError.getField()).append(": ");
			stringBuilder.append(fieldError.getDefaultMessage());
			stringBuilder.append("\n ");
		}
		final ErrorResponse response = ErrorResponse.of(ErrorCode.NOT_VALID_ERROR,
			String.valueOf(stringBuilder));

		return ResponseEntity.badRequest().body(response);
	}
	
    ...
}

```
</div>
</details>
<details>
<summary><b>JWT ê´€ë¦¬</b></summary>
<div markdown="1">

<h4>ê°œìš”</h4>
1. AccessTokenì€ 7ì¼, RefreshTokenì€ 30ì¼ì˜ ìœ íš¨ê¸°ê°„ì„ ê°€ì§‘ë‹ˆë‹¤.
2. HS256 ë‹¨ë°©í–¥ ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
3. MalformedJwtException, SignatureException, ExpiredJwtException ë¥¼ ì²´í¬í•˜ì—¬ ì‹¤íŒ¨ì‹œ ì—ëŸ¬ë©”ì„¸ì§€ì™€ 403ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
4. RefreshTokenì´ ìœ íš¨í•  ê²½ìš° AccessToken ë§Œë£Œì‹œ ì¬ë°œê¸‰í•˜ë©° 3ì¼ ì´ë‚´ì¼ ê²½ìš° RefreshTokenë„ ì¬ë°œê¸‰í•©ë‹ˆë‹¤.
 

   <a src="https://github.com/junghunchoi/portfolio/blob/master/backend/src/main/java/com/backend/security/filter/RefreshTokenFilter.java">RefreshTokenFilter</a>
```java

class RefreshTokenFilter{
    ...
    try {
		checkAccessToken(accessToken);
	} catch (RefreshTokenException refreshTokenException) {
		refreshTokenException.sendResponseError(response);
		return;
	}

	Map<String, Object> refreshClaims = null;

	try {
		refreshClaims = checkRefreshToken(refreshToken);
	} catch (RefreshTokenException refreshTokenException) {
		refreshTokenException.sendResponseError(response);
		return;
	}

	// Refresh Tokenì˜ ìœ íš¨ì‹œê°„ì´ ì–¼ë§ˆ ë‚¨ì§€ ì•Šì€ ê²½ìš°
	Integer exp = (Integer) refreshClaims.get("exp");

	Date expTime = new Date(Instant.ofEpochMilli(exp).toEpochMilli() * 1000);
	Date current = new Date(System.currentTimeMillis());

	// ë§Œë£Œ ì‹œê°„ê³¼ í˜„ì¬ ì‹œê°„ì˜ ê°„ê²© ê³„ì‚°
	long gapTime = (expTime.getTime() - current.getTime());
	String userName = (String) refreshClaims.get("userName");

	// ì´ ìƒíƒœê¹Œì§€ ì˜¤ë©´ ë¬´ì¡°ê±´ AccessTokenì€ ìƒˆë¡œ ìƒì„±
	String accessTokenValue = jwtUtil.generateToken(Map.of("userName", userName), accessTokenExpiration);
	String refreshTokenValue = tokens.get("refreshToken");

	// ë§Œì¼ 3ì¼ ë¯¸ë§Œì¸ ê²½ìš°ì—ëŠ” Refresh Tokenë„ ë‹¤ì‹œ ìƒì„±
		if (gapTime < (1000 * 60 * 3)) {
		log.info("new Refresh Token required...  ");
		refreshTokenValue = jwtUtil.generateToken(Map.of("userName", userName), refreshTokenExpiration);
	}
    ...	
}

```

</details>


</br>

## ğŸ”ERD
![](readmeimage/í¬íŠ¸í´ë¦¬ì˜¤.png)

</br>

## âš™ï¸ ì•„í‚¤í…ì³
![](readmeimage/ì•„í‚¤í…ì³.png)

## ê¸°ìˆ  ìŠ¤íƒ
### ë°±ì—”ë“œ

<img src="https://img.shields.io/badge/Spring Boot-6DB33F?style=flat-square&logo=Spring Boot&logoColor=white"></br>
<img src="https://img.shields.io/badge/JPA-59666C?style=flat-square&logo=Hibernate&logoColor=white"></br>
<img src="https://img.shields.io/badge/Spring_Security-6DB33F?style=flat-square&logo=Spring-Security&logoColor=white"></br>

### í”„ë¡ íŠ¸ì—”ë“œ

<img src="https://img.shields.io/badge/Vue.js-35495E?style=flat-square&logo=vue.js&logoColor=4FC08D"></br>
<img src="https://img.shields.io/badge/Pinia-35495E?style=flat-square&logo=vuedotjs&logoColor=4FC08D"></br>
<img src="https://img.shields.io/badge/Bootstrap--Vue-563D7C?style=flat-square&logo=bootstrap-vue&logoColor=white"></br>
<img src="https://img.shields.io/badge/Vite-646CFF?style=flat-square&logo=vite&logoColor=white"></br>

### ë°ì´í„°ë² ì´ìŠ¤ 

<img src="https://img.shields.io/badge/MariaDB-003545?style=flat-square&logo=mariadb&logoColor=white"></br>


### ì¸í”„ë¼ 

<img src="https://img.shields.io/badge/Amazon AWS EC2-232F3E?style=flat-square&logo=amazon-aws&logoColor=white"></br>
<img src="https://img.shields.io/badge/Docker-2496ED?style=flat-square&logo=docker&logoColor=white"></br>
<img src="https://img.shields.io/badge/Docker_Compose-2496ED?style=flat-square&logo=docker&logoColor=white"></br>
<img src="https://img.shields.io/badge/Nginx-009639?style=flat-square&logo=nginx&logoColor=white"></br>


### ë²„ì „
- <b>Java 14</b>
- <b>Spring boot 2.7.14</b>
- <b>Vue 3 (Composition API)</b>
- <b>MariaDB 10.11</b>

</br>




